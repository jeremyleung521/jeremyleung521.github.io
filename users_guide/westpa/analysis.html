

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Analysis &mdash; WESTPA 2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../sphinx_index2.html" class="icon icon-home" alt="Documentation Home"> WESTPA
          

          
            
            <img src="../../_static/WESTPA2b.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../test/westpa.cli.core.html"> WESTPA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../westpa_tools.html"> WESTPA tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wwmgr.html"> WESTPA work manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../westpaext.html"> WESTPA extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_line_tools.html"> Command line tool index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hdf5.html"> HDF5 file structure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/overview.html"> Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/style_guide.html"> Code and documentation style guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/source_code.html"> Source code management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/documentation.html"> Building the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/api.html">WESTPA Modules API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/api.html#westpa-tools">WESTPA Tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../sphinx_index2.html">WESTPA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../sphinx_index2.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Analysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/users_guide/westpa/analysis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="analysis">
<h1>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="gauging-simulation-progress-and-convergence">
<h2>Gauging simulation progress and convergence<a class="headerlink" href="#gauging-simulation-progress-and-convergence" title="Permalink to this headline">¶</a></h2>
<div class="section" id="progress-coordinate-distribution-w-pcpdist">
<h3>Progress coordinate distribution (w_pcpdist)<a class="headerlink" href="#progress-coordinate-distribution-w-pcpdist" title="Permalink to this headline">¶</a></h3>
<p>w_pcpdist and plothist</p>
</div>
<div class="section" id="kinetics-for-source-sink-simulations">
<h3>Kinetics for source/sink simulations<a class="headerlink" href="#kinetics-for-source-sink-simulations" title="Permalink to this headline">¶</a></h3>
<p>w_fluxanl</p>
</div>
<div class="section" id="kinetics-for-arbitrary-state-definitions">
<h3>Kinetics for arbitrary state definitions<a class="headerlink" href="#kinetics-for-arbitrary-state-definitions" title="Permalink to this headline">¶</a></h3>
<p>In order to calculate rate constants, it is necessary to run three different
tools:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- :ref:`w_assign`
- :ref:`w_kinetics`
- :ref:`w_kinavg`
</pre></div>
</div>
<p>The w_assign tool assigns trajectories to states (states which correspond to a
target bin) at a sub-tau resolution. This allows w_kinetics to properly trace
the trajectories and prepare the data for further analysis.</p>
<p>Although the bin and state definitions can be pulled from the system, it is
frequently more convenient to specify custom bin boundaries and states; this
eliminates the need to know what constitutes a state prior to starting the
simulation. Both files must be in the YAML format, of which there are numerous
examples of online. A quick example for each file follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">States</span><span class="p">:</span>
<span class="o">---</span>
<span class="n">states</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">label</span><span class="p">:</span> <span class="n">unbound</span>
    <span class="n">coords</span><span class="p">:</span>
      <span class="o">-</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="o">-</span> <span class="n">label</span><span class="p">:</span> <span class="n">boun</span>
    <span class="n">coords</span><span class="p">:</span>
      <span class="o">-</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">33.0</span><span class="p">]</span>

<span class="n">Bins</span><span class="p">:</span>
<span class="o">---</span>
<span class="n">bins</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="n">RectilinearBinMapper</span>
  <span class="n">boundaries</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.57</span><span class="p">,</span><span class="mf">25.0</span><span class="p">,</span><span class="mi">10000</span><span class="p">],[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">33.0</span><span class="p">,</span><span class="mi">10000</span><span class="p">]]</span>
</pre></div>
</div>
<p>This system has a two dimensional progress coordinate, and two definite states,
as defined by the PMF. The binning used during the simulation was significantly
more complex; defining a smaller progress coordinate (in which we have three
regions: bound, unbound, and in between) is simply a matter of convenience.
Note that these custom bins do not change the simulation in any fashion; you
can adjust state definitions and bin boundaries at will without altering the
way the simulation runs.</p>
<p>The help definition, included by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w_assign</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>usually contains the most up-to-date help information, and so more
information about command line options can be obtained from there. To
run with the above YAML files, assuming they are named STATES and BINS,
you would run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w_assign</span> <span class="o">--</span><span class="n">states</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">file</span> <span class="n">STATES</span> <span class="o">--</span><span class="n">bins</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">file</span> <span class="n">BINS</span>
</pre></div>
</div>
<p>By default, this produces a .h5 file (named assign.h5); this can be changed via
the command line.</p>
<p>The w_kinetics tool uses the information generated from w_assign to trace
through trajectories and calculate flux with included color information. There
are two main methods to run w_kinetics:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w_kinetics</span> <span class="n">trace</span>
<span class="n">w_kinetics</span> <span class="n">matrix</span>
</pre></div>
</div>
<p>The matrix method is still in development; at this time, trace is the
recommended method.</p>
<p>Once the w_kinetics analysis is complete, you can check for convergence of the
rate constants. WESTPA includes two tools to help you do this: w_kinavg and
ploterr. First, begin by running the following command (keep in mind that
w_kinavg has the same type of analysis as w_kinetics does; whatever method you
chose (trace or matrix) in the w_kinetics step should be used here, as well):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w_kinavg</span> <span class="n">trace</span> <span class="o">-</span><span class="n">e</span> <span class="n">cumulative</span>
</pre></div>
</div>
<p>This instructs w_kinavg to produce a .h5 file with the cumulative rate
information; by then using ploterr, you can determine whether the rates
have stopped changing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ploterr</span> <span class="n">kinavg</span>
</pre></div>
</div>
<p>By default, this produces a set of .pdf files, containing cumulative rate and
flux information for each state-to-state transition as a function of the WESTPA
iteration. Determine at which iteration the rate stops changing; then, rerun
w_kinavg with the following systems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w_kinavg</span> <span class="n">trace</span> <span class="o">--</span><span class="n">first</span><span class="o">-</span><span class="nb">iter</span> <span class="n">ITER</span>
</pre></div>
</div>
<p>where ITER is the beginning of the unchanging region. This will then
output information much like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fluxes</span> <span class="n">into</span> <span class="n">macrostates</span><span class="p">:</span>
<span class="n">unbound</span><span class="p">:</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.712580005863456e-02</span> <span class="n">CI</span><span class="o">=</span><span class="p">(</span><span class="mf">1.596595628304422e-02</span><span class="p">,</span> <span class="mf">1.808249529394858e-02</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="o">^-</span><span class="mi">1</span>
<span class="n">bound</span>  <span class="p">:</span> <span class="n">mean</span><span class="o">=</span><span class="mf">5.944989301935855e-04</span> <span class="n">CI</span><span class="o">=</span><span class="p">(</span><span class="mf">4.153556214886056e-04</span><span class="p">,</span> <span class="mf">7.789568983584020e-04</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="o">^-</span><span class="mi">1</span>

<span class="n">fluxes</span> <span class="kn">from</span> <span class="nn">state</span> <span class="n">to</span> <span class="n">state</span><span class="p">:</span>
<span class="n">unbound</span> <span class="o">-&gt;</span> <span class="n">bound</span>  <span class="p">:</span> <span class="n">mean</span><span class="o">=</span><span class="mf">5.944989301935855e-04</span> <span class="n">CI</span><span class="o">=</span><span class="p">(</span><span class="mf">4.253003401668849e-04</span><span class="p">,</span> <span class="mf">7.720997503648696e-04</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="o">^-</span><span class="mi">1</span>
<span class="n">bound</span>   <span class="o">-&gt;</span> <span class="n">unbound</span><span class="p">:</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.712580005863456e-02</span> <span class="n">CI</span><span class="o">=</span><span class="p">(</span><span class="mf">1.590547796439216e-02</span><span class="p">,</span> <span class="mf">1.808154616175579e-02</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="o">^-</span><span class="mi">1</span>

<span class="n">rates</span> <span class="kn">from</span> <span class="nn">state</span> <span class="n">to</span> <span class="n">state</span><span class="p">:</span>
<span class="n">unbound</span> <span class="o">-&gt;</span> <span class="n">bound</span>  <span class="p">:</span> <span class="n">mean</span><span class="o">=</span><span class="mf">9.972502012305491e-03</span> <span class="n">CI</span><span class="o">=</span><span class="p">(</span><span class="mf">7.165030136921814e-03</span><span class="p">,</span> <span class="mf">1.313767180582492e-02</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="o">^-</span><span class="mi">1</span>
<span class="n">bound</span>   <span class="o">-&gt;</span> <span class="n">unbound</span><span class="p">:</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.819520888349874e-02</span> <span class="n">CI</span><span class="o">=</span><span class="p">(</span><span class="mf">1.704608273094848e-02</span><span class="p">,</span> <span class="mf">1.926165865735958e-02</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="o">^-</span><span class="mi">1</span>
</pre></div>
</div>
<p>Divide by tau to calculate your rate constant.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Matthew C. Zwier and Lillian T. Chong

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>